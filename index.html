<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Egerton U15 Lions Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .tooltip {
            position: relative;
            cursor: help;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #1f2937;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            line-height: 1.5;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app">
        <div class="min-h-screen flex items-center justify-center">
            <div class="text-center">
                <div class="w-16 h-16 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                <p class="text-gray-600">Loading Egerton U15 Lions data...</p>
            </div>
        </div>
    </div>

    <script>
        const SPREADSHEET_ID = '1sMHiLgwRAsnu2zWRCfdHWwuEMfefpOe30BIo_Zv01IE';
        const API_KEY = 'AIzaSyAkb76g25dIADs9Ty5CD3V7BguWe3ahLPs';
        const BADGE_IMG = 'egerton-tracker.png';
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby6a_XWdPHAjEcId0-A57dRG26w_VJlF38lsVuBqnPGzeXAo3RTM76phbB7RA5n9zuwAA/exec';

        let currentTab = 'overview';
        let allMatches = [];
        let resultFilter = null;
        let fixtures = [];
        let results = [];
        let players = [];

        function setActiveTab(tab) {
            currentTab = tab;
            resultFilter = null;
            renderApp();
        }

        function filterResults(type) {
            resultFilter = type;
            currentTab = 'results';
            renderApp();
        }

        function formatGoalScorers(scorersText, notesText) {
            if (!scorersText || scorersText === 'NO GOALS') {
                return 'No goals scored';
            }

            // Split the scorers and their goal counts
            const scorers = scorersText.split(',').map(s => s.trim());
            const goalCounts = notesText ? notesText.split(',').map(s => s.trim()) : [];

            // Match them up
            const formatted = scorers.map((scorer, index) => {
                const goals = goalCounts[index] || '1';
                return `${scorer} (${goals})`;
            });

            return formatted.join(', ');
        }

        function parseDate(dateStr) {
            // Parse date in format like "14 September 2025" or "28 September 2025"
            if (!dateStr) return null;
            
            const months = {
                'january': 0, 'february': 1, 'march': 2, 'april': 3,
                'may': 4, 'june': 5, 'july': 6, 'august': 7,
                'september': 8, 'october': 9, 'november': 10, 'december': 11
            };
            
            const parts = dateStr.toLowerCase().split(' ');
            if (parts.length >= 3) {
                const day = parseInt(parts[0]);
                const month = months[parts[1]];
                const year = parseInt(parts[2]);
                
                if (!isNaN(day) && month !== undefined && !isNaN(year)) {
                    return new Date(year, month, day);
                }
            }
            
            return null;
        }

        async function fetchSheetData() {
            try {
                const [fixturesRes, playersRes] = await Promise.all([
                    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Fixtures?key=${API_KEY}`),
                    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Players?key=${API_KEY}`)
                ]);

                const fixturesData = await fixturesRes.json();
                const playersData = await playersRes.json();

                console.log('Raw fixtures data:', fixturesData);
                console.log('Raw players data:', playersData);

                // Parse fixtures data (skip header row)
                if (fixturesData.values && fixturesData.values.length > 1) {
                    allMatches = fixturesData.values.slice(1)
                        .filter(row => row && row.length >= 11 && row[0]) // Has ID and enough columns
                        .map(row => ({
                            id: row[0],
                            date: row[1] || '',
                            dateObj: parseDate(row[1]),
                            kickOffTime: row[2] || '',
                            opponent: row[3] || '',
                            venue: row[4] || '',
                            competition: row[5] || '',
                            ourScore: row[6] || '',
                            goalScorers: row[7] || '',
                            notes: row[8] || '',
                            theirScore: row[9] || '',
                            status: row[10] || ''
                        }));

                    console.log('All matches:', allMatches);

                    // Split into fixtures and results based on status
                    fixtures = allMatches.filter(m => 
                        m.status && (m.status.toLowerCase() === 'scheduled' || m.status.toLowerCase() === 'postponed')
                    );
                    
                    results = allMatches.filter(m => 
                        m.status && m.status.toLowerCase() === 'played'
                    ).map(match => {
                        const ourScore = parseInt(match.ourScore) || 0;
                        const theirScore = parseInt(match.theirScore) || 0;
                        let result = 'Draw';
                        if (ourScore > theirScore) result = 'Win';
                        else if (ourScore < theirScore) result = 'Loss';
                        
                        return {
                            ...match,
                            goalsFor: ourScore,
                            goalsAgainst: theirScore,
                            result: result
                        };
                    });

                    // Sort results by date (most recent first)
                    results.sort((a, b) => {
                        if (!a.dateObj || !b.dateObj) return 0;
                        return b.dateObj - a.dateObj; // Descending order (newest first)
                    });

                    console.log('Fixtures:', fixtures);
                    console.log('Results (sorted):', results);
                }

                // Parse players data
                // Expected columns: Shirt Number, Name, Position, Goals, MOTM
                if (playersData.values && playersData.values.length > 1) {
                    players = playersData.values.slice(1)
                        .filter(row => row && row.length >= 2 && row[1]) // Must have at least shirt number and name
                        .map(row => ({
                            shirtNumber: row[0] || '',
                            name: row[1] || '',
                            position: row[2] || '',
                            goals: parseInt(row[3]) || 0,
                            motm: parseInt(row[4]) || 0
                        }));

                    console.log('Players:', players);
                }

                renderApp();
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('app').innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="text-center">
                            <p class="text-red-600 mb-4">Error loading data. Please check console for details.</p>
                            <button onclick="fetchSheetData()" class="px-4 py-2 bg-yellow-400 text-gray-900 rounded-lg hover:bg-yellow-500">
                                Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function getResultCounts() {
            const wins = results.filter(r => r.result === 'Win').length;
            const draws = results.filter(r => r.result === 'Draw').length;
            const losses = results.filter(r => r.result === 'Loss').length;
            return { wins, draws, losses };
        }

        function createScorelineWithTooltip(match) {
            const formattedScorers = formatGoalScorers(match.goalScorers, match.notes);
            
            return `
                <div class="tooltip inline-block">
                    <span class="font-semibold">${match.goalsFor}-${match.goalsAgainst}</span>
                    <span class="tooltiptext">
                        <div class="font-semibold mb-2">Goal Scorers:</div>
                        <div>${formattedScorers}</div>
                    </span>
                </div>
            `;
        }

        function renderApp() {
            const { wins, draws, losses } = getResultCounts();
            const played = results.length;
            const upcomingFixtures = fixtures.slice(0, 3);
            const recentResults = results.slice(0, 3); // Already sorted by date (most recent first)
            
            const topScorers = [...players]
                .sort((a, b) => b.goals - a.goals)
                .slice(0, 3);
            
            const topMOTM = [...players]
                .filter(p => p.motm > 0)
                .sort((a, b) => b.motm - a.motm)
                .slice(0, 1);

            let filteredResults = results;
            if (resultFilter) {
                filteredResults = results.filter(r => r.result === resultFilter);
            }

            document.getElementById('app').innerHTML = `
                <div class="min-h-screen flex flex-col md:flex-row">
                    <!-- Mobile Header -->
                    <div class="md:hidden bg-gray-900 text-white p-4 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <img src="${BADGE_IMG}" class="w-10 h-10" alt="Egerton FC Badge">
                            <div>
                                <h1 class="text-lg font-bold text-yellow-400">Egerton U15 Lions</h1>
                            </div>
                        </div>
                        <button onclick="fetchSheetData()" class="text-gray-400 p-2">
                            üîÑ
                        </button>
                    </div>

                    <!-- Desktop Sidebar -->
                    <div class="hidden md:flex w-64 bg-gray-900 text-white flex-col fixed h-full">
                        <div class="p-6 border-b border-gray-700">
                            <div class="flex items-center gap-3">
                                <img src="${BADGE_IMG}" class="w-12 h-12" alt="Egerton FC Badge">
                                <div>
                                    <h1 class="text-xl font-bold text-yellow-400">Egerton U15 Lions</h1>
                                    <p class="text-sm text-gray-400">Season 2025/26</p>
                                </div>
                            </div>
                        </div>
                        
                        <nav class="flex-1 p-4">
                            <button onclick="setActiveTab('overview')" 
                                class="w-full text-left px-4 py-3 rounded-lg mb-2 transition-colors ${currentTab === 'overview' ? 'bg-yellow-400 text-gray-900 font-semibold' : 'text-gray-300 hover:bg-gray-800'}">
                                üìä Overview
                            </button>
                            <button onclick="setActiveTab('fixtures')" 
                                class="w-full text-left px-4 py-3 rounded-lg mb-2 transition-colors ${currentTab === 'fixtures' ? 'bg-yellow-400 text-gray-900 font-semibold' : 'text-gray-300 hover:bg-gray-800'}">
                                üìÖ Fixtures
                            </button>
                            <button onclick="setActiveTab('results')" 
                                class="w-full text-left px-4 py-3 rounded-lg mb-2 transition-colors ${currentTab === 'results' ? 'bg-yellow-400 text-gray-900 font-semibold' : 'text-gray-300 hover:bg-gray-800'}">
                                üèÜ Results
                            </button>
                            <button onclick="setActiveTab('players')" 
                                class="w-full text-left px-4 py-3 rounded-lg mb-2 transition-colors ${currentTab === 'players' ? 'bg-yellow-400 text-gray-900 font-semibold' : 'text-gray-300 hover:bg-gray-800'}">
                                üë• Players
                            </button>
                            <button onclick="setActiveTab('admin')" 
                                class="w-full text-left px-4 py-3 rounded-lg transition-colors ${currentTab === 'admin' ? 'bg-yellow-400 text-gray-900 font-semibold' : 'text-gray-300 hover:bg-gray-800'}">
                                ‚öôÔ∏è Admin
                            </button>
                        </nav>

                        <div class="p-4 border-t border-gray-700">
                            <button onclick="fetchSheetData()" 
                                class="w-full px-4 py-2 bg-gray-800 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors text-sm">
                                üîÑ Refresh Data
                            </button>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <main class="flex-1 p-4 md:p-8 md:ml-64 pb-24 md:pb-8">
                        ${currentTab === 'overview' ? `
                            <div class="mb-6 md:mb-8 flex items-center gap-3 md:gap-4">
                                <img src="${BADGE_IMG}" class="w-14 h-14 md:w-20 md:h-20" alt="Egerton FC Badge">
                                <div>
                                    <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-1 md:mb-2">Season Overview</h2>
                                    <p class="text-sm md:text-base text-gray-600">Track your team's performance</p>
                                </div>
                            </div>

                            <!-- Stats Cards -->
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                                <div class="bg-white rounded-lg border border-gray-200 p-4 md:p-6">
                                    <div class="text-xs md:text-sm font-medium text-gray-500 mb-1">Played</div>
                                    <div class="text-2xl md:text-3xl font-bold text-gray-900">${played}</div>
                                </div>
                                <div onclick="filterResults('Win')" class="bg-green-50 rounded-lg border border-green-200 p-4 md:p-6 cursor-pointer hover:bg-green-100 transition-colors">
                                    <div class="text-xs md:text-sm font-medium text-green-700 mb-1">Wins</div>
                                    <div class="text-2xl md:text-3xl font-bold text-green-600">${wins}</div>
                                </div>
                                <div onclick="filterResults('Draw')" class="bg-yellow-50 rounded-lg border border-yellow-200 p-4 md:p-6 cursor-pointer hover:bg-yellow-100 transition-colors">
                                    <div class="text-xs md:text-sm font-medium text-yellow-700 mb-1">Draws</div>
                                    <div class="text-2xl md:text-3xl font-bold text-yellow-600">${draws}</div>
                                </div>
                                <div onclick="filterResults('Loss')" class="bg-red-50 rounded-lg border border-red-200 p-4 md:p-6 cursor-pointer hover:bg-red-100 transition-colors">
                                    <div class="text-xs md:text-sm font-medium text-red-700 mb-1">Losses</div>
                                    <div class="text-2xl md:text-3xl font-bold text-red-600">${losses}</div>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                                <!-- Upcoming Fixtures -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    <div class="p-5 border-b border-gray-100">
                                        <h2 class="text-lg font-semibold text-gray-900">Upcoming Fixtures</h2>
                                    </div>
                                    <div class="p-5">
                                        ${upcomingFixtures.length > 0 ? upcomingFixtures.map(fixture => `
                                            <div class="flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0">
                                                <div class="flex-1">
                                                    <div class="font-medium text-gray-900">${fixture.opponent}</div>
                                                    <div class="text-sm text-gray-500">${fixture.date} ‚Ä¢ ${fixture.kickOffTime}</div>
                                                    <div class="text-sm text-gray-500">${fixture.competition}</div>
                                                </div>
                                                <div class="text-right">
                                                    <span class="px-3 py-1 rounded-full text-xs font-medium ${fixture.venue === 'Home' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
                                                        ${fixture.venue}
                                                    </span>
                                                </div>
                                            </div>
                                        `).join('') : '<p class="text-gray-500 text-center py-4">No upcoming fixtures</p>'}
                                    </div>
                                </div>

                                <!-- Recent Results -->
                                <div class="bg-white rounded-lg border border-gray-200">
                                    <div class="p-5 border-b border-gray-100">
                                        <h2 class="text-lg font-semibold text-gray-900">Recent Results</h2>
                                    </div>
                                    <div class="p-5">
                                        ${recentResults.length > 0 ? recentResults.map(result => `
                                            <div class="flex items-center justify-between py-3 border-b border-gray-100 last:border-b-0">
                                                <div class="flex-1">
                                                    <div class="font-medium text-gray-900">${result.opponent}</div>
                                                    <div class="text-sm text-gray-500">${result.date}</div>
                                                </div>
                                                <div class="text-right">
                                                    <div class="mb-1">
                                                        ${createScorelineWithTooltip(result)}
                                                    </div>
                                                    <span class="px-2 py-1 rounded text-xs font-medium ${
                                                        result.result === 'Win' ? 'bg-green-100 text-green-700' :
                                                        result.result === 'Draw' ? 'bg-yellow-100 text-yellow-700' :
                                                        'bg-red-100 text-red-700'
                                                    }">
                                                        ${result.result}
                                                    </span>
                                                </div>
                                            </div>
                                        `).join('') : '<p class="text-gray-500 text-center py-4">No results yet</p>'}
                                    </div>
                                </div>
                            </div>

                            <!-- Top Performers -->
                            ${topScorers.length > 0 || topMOTM.length > 0 ? `
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    ${topScorers.length > 0 ? `
                                        <div class="bg-white rounded-lg border border-gray-200">
                                            <div class="p-5 border-b border-gray-100">
                                                <h2 class="text-sm font-semibold text-gray-900">Top Scorers</h2>
                                            </div>
                                            <div class="p-5">
                                                ${topScorers.map((player, idx) => `
                                                    <div class="flex items-center justify-between ${idx < topScorers.length - 1 ? 'mb-4' : ''}">
                                                        <div class="flex items-center gap-3">
                                                            <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-sm font-medium text-gray-600">
                                                                ${idx + 1}
                                                            </div>
                                                            <div>
                                                                <div class="font-medium text-gray-900 text-sm">${player.name}</div>
                                                                <div class="text-xs text-gray-500">${player.position}</div>
                                                            </div>
                                                        </div>
                                                        <div class="text-xl font-semibold text-gray-900">${player.goals}</div>
                                                    </div>
                                                `).join('')}
                                            </div>
                                        </div>
                                    ` : ''}

                                    ${topMOTM.length > 0 ? `
                                        <div class="bg-white rounded-lg border border-gray-200">
                                            <div class="p-5 border-b border-gray-100">
                                                <h2 class="text-sm font-semibold text-gray-900">Top MOTM Awards</h2>
                                            </div>
                                            <div class="p-5">
                                                <div class="flex items-center gap-4">
                                                    <div class="w-16 h-16 rounded-full bg-yellow-100 flex items-center justify-center">
                                                        <span class="text-lg font-semibold text-yellow-700">${topMOTM[0].name.split(' ').map(n => n[0]).join('')}</span>
                                                    </div>
                                                    <div class="flex-1">
                                                        <div class="font-semibold text-gray-900">${topMOTM[0].name}</div>
                                                        <div class="text-sm text-gray-500">${topMOTM[0].position}</div>
                                                    </div>
                                                    <div class="text-3xl font-semibold text-gray-900">${topMOTM[0].motm}</div>
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            ` : ''}
                        ` : ''}

                        ${currentTab === 'fixtures' ? `
                            <div class="mb-8">
                                <h2 class="text-3xl font-bold text-gray-900 mb-2">Fixtures</h2>
                                <p class="text-gray-600">Upcoming matches for the season</p>
                            </div>

                            <div class="bg-white rounded-lg border border-gray-200">
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-50 border-b border-gray-200">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Opponent</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Venue</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Competition</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${fixtures.length > 0 ? fixtures.map(fixture => `
                                                <tr class="hover:bg-gray-50">
                                                    <td class="px-6 py-4 text-sm text-gray-900">${fixture.date}</td>
                                                    <td class="px-6 py-4 text-sm text-gray-900">${fixture.kickOffTime}</td>
                                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${fixture.opponent}</td>
                                                    <td class="px-6 py-4 text-sm">
                                                        <span class="px-2 py-1 rounded-full text-xs font-medium ${fixture.venue === 'Home' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
                                                            ${fixture.venue}
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4 text-sm text-gray-900">${fixture.competition}</td>
                                                    <td class="px-6 py-4 text-sm">
                                                        <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                            fixture.status.toLowerCase() === 'scheduled' ? 'bg-gray-100 text-gray-700' : 'bg-orange-100 text-orange-700'
                                                        }">
                                                            ${fixture.status}
                                                        </span>
                                                    </td>
                                                </tr>
                                            `).join('') : `
                                                <tr>
                                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">No fixtures scheduled</td>
                                                </tr>
                                            `}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ` : ''}

                        ${currentTab === 'results' ? `
                            <div class="mb-8">
                                <h2 class="text-3xl font-bold text-gray-900 mb-2">Results ${resultFilter ? `- ${resultFilter}s` : ''}</h2>
                                <p class="text-gray-600">Match results for the season</p>
                                ${resultFilter ? `
                                    <button onclick="resultFilter = null; renderApp()" class="mt-2 text-sm text-blue-600 hover:text-blue-700">
                                        ‚Üê Show all results
                                    </button>
                                ` : ''}
                            </div>

                            <div class="bg-white rounded-lg border border-gray-200">
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-50 border-b border-gray-200">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Opponent</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Venue</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Competition</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Score</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Result</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${filteredResults.length > 0 ? filteredResults.map(result => `
                                                <tr class="hover:bg-gray-50">
                                                    <td class="px-6 py-4 text-sm text-gray-900">${result.date}</td>
                                                    <td class="px-6 py-4 text-sm font-medium text-gray-900">${result.opponent}</td>
                                                    <td class="px-6 py-4 text-sm">
                                                        <span class="px-2 py-1 rounded-full text-xs font-medium ${result.venue === 'Home' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
                                                            ${result.venue}
                                                        </span>
                                                    </td>
                                                    <td class="px-6 py-4 text-sm text-gray-900">${result.competition}</td>
                                                    <td class="px-6 py-4 text-sm">
                                                        ${createScorelineWithTooltip(result)}
                                                    </td>
                                                    <td class="px-6 py-4 text-sm">
                                                        <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                            result.result === 'Win' ? 'bg-green-100 text-green-700' :
                                                            result.result === 'Draw' ? 'bg-yellow-100 text-yellow-700' :
                                                            'bg-red-100 text-red-700'
                                                        }">
                                                            ${result.result}
                                                        </span>
                                                    </td>
                                                </tr>
                                            `).join('') : `
                                                <tr>
                                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                                        ${resultFilter ? `No ${resultFilter.toLowerCase()}s found` : 'No results yet'}
                                                    </td>
                                                </tr>
                                            `}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ` : ''}

                        ${currentTab === 'players' ? `
                            <div class="mb-8">
                                <h2 class="text-3xl font-bold text-gray-900 mb-2">Squad</h2>
                                <p class="text-gray-600">Player statistics for the season</p>
                            </div>

                            <div class="bg-white rounded-lg border border-gray-200">
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead class="bg-gray-50 border-b border-gray-200">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Shirt</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Player</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Position</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Goals</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">MOTM</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-gray-200">
                                            ${players.length > 0 ? players.map(player => `
                                                <tr class="hover:bg-gray-50">
                                                    <td class="px-6 py-4">
                                                        <div class="w-10 h-10 rounded-full bg-gray-900 text-white flex items-center justify-center font-bold">
                                                            ${player.shirtNumber}
                                                        </div>
                                                    </td>
                                                    <td class="px-6 py-4">
                                                        <span class="font-medium text-gray-900">${player.name}</span>
                                                    </td>
                                                    <td class="px-6 py-4 text-sm text-gray-900">${player.position}</td>
                                                    <td class="px-6 py-4 text-sm font-semibold text-gray-900">${player.goals}</td>
                                                    <td class="px-6 py-4 text-sm">
                                                        ${player.motm > 0 ? `<span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-yellow-100 text-yellow-700 font-semibold">${player.motm}</span>` : '-'}
                                                    </td>
                                                </tr>
                                            `).join('') : `
                                                <tr>
                                                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">No player data available</td>
                                                </tr>
                                            `}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        ` : ''}

                        ${currentTab === 'admin' ? `
                            <div class="max-w-xl">
                                <!-- Header -->
                                <div class="mb-10">
                                    <h2 class="text-4xl font-semibold text-gray-900 tracking-tight">Admin</h2>
                                    <p class="text-lg text-gray-500 mt-2">Update match results</p>
                                </div>

                                <!-- Match Cards -->
                                <div class="space-y-3" id="matchCards">
                                    ${allMatches.filter(m => m.status === 'Scheduled' || m.status === 'Postponed').length > 0 ? 
                                        allMatches.filter(m => m.status === 'Scheduled' || m.status === 'Postponed').map(match => `
                                        <div onclick="selectMatch('${match.id}')" 
                                             id="card-${match.id}"
                                             class="bg-white rounded-2xl p-5 cursor-pointer transition-all duration-200 hover:shadow-md border-2 border-transparent hover:border-yellow-400">
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <div class="font-semibold text-gray-900 text-lg">${match.opponent}</div>
                                                    <div class="text-gray-500 mt-1">${match.date} ¬∑ ${match.kickOffTime}</div>
                                                </div>
                                                <div class="flex items-center gap-3">
                                                    <span class="px-3 py-1 rounded-full text-sm font-medium ${match.venue === 'Home' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">
                                                        ${match.venue}
                                                    </span>
                                                    ${match.status === 'Postponed' ? '<span class="px-3 py-1 rounded-full text-sm font-medium bg-orange-100 text-orange-700">Postponed</span>' : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `).join('') : '<p class="text-gray-500 text-center py-8">No upcoming matches to update</p>'}
                                </div>

                                <!-- Edit Form (hidden by default) -->
                                <div id="matchForm" class="hidden mt-8">
                                    <div class="bg-white rounded-2xl p-8 shadow-sm">
                                        <!-- Match Header -->
                                        <div id="matchInfo" class="mb-8 pb-6 border-b border-gray-100"></div>

                                        <!-- Status -->
                                        <div class="mb-8">
                                            <label class="block text-sm font-medium text-gray-500 uppercase tracking-wide mb-3">Status</label>
                                            <div class="grid grid-cols-2 gap-3">
                                                <button type="button" onclick="setStatus('Played')" id="btn-Played" class="status-btn py-3 px-4 rounded-xl border-2 border-gray-200 text-gray-700 font-medium transition-all">Played</button>
                                                <button type="button" onclick="setStatus('Postponed')" id="btn-Postponed" class="status-btn py-3 px-4 rounded-xl border-2 border-gray-200 text-gray-700 font-medium transition-all">Postponed</button>
                                            </div>
                                        </div>

                                        <!-- Score Section -->
                                        <div id="scoreSection" class="hidden">
                                            <!-- Score Inputs -->
                                            <div class="mb-8">
                                                <label class="block text-sm font-medium text-gray-500 uppercase tracking-wide mb-3">Final Score</label>
                                                <div class="flex items-center gap-4">
                                                    <div class="flex-1">
                                                        <div class="text-center text-sm text-gray-500 mb-2">Egerton</div>
                                                        <input type="number" id="adminOurScore" min="0" 
                                                               class="w-full text-center text-4xl font-bold py-4 border-2 border-gray-200 rounded-xl focus:border-yellow-400 focus:outline-none transition-colors" 
                                                               placeholder="0">
                                                    </div>
                                                    <div class="text-3xl text-gray-300 font-light">-</div>
                                                    <div class="flex-1">
                                                        <div class="text-center text-sm text-gray-500 mb-2" id="opponentName">Opponent</div>
                                                        <input type="number" id="adminTheirScore" min="0" 
                                                               class="w-full text-center text-4xl font-bold py-4 border-2 border-gray-200 rounded-xl focus:border-yellow-400 focus:outline-none transition-colors" 
                                                               placeholder="0">
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Goal Scorers -->
                                            <div class="mb-8">
                                                <label class="block text-sm font-medium text-gray-500 uppercase tracking-wide mb-3">Goal Scorers</label>
                                                <input type="text" id="adminGoalScorers" 
                                                       class="w-full py-4 px-5 border-2 border-gray-200 rounded-xl focus:border-yellow-400 focus:outline-none transition-colors text-gray-900" 
                                                       placeholder="Finley Jones, Jack Stiles">
                                                <p class="text-sm text-gray-400 mt-2">Separate names with commas</p>
                                            </div>

                                            <!-- Goals Each -->
                                            <div class="mb-8">
                                                <label class="block text-sm font-medium text-gray-500 uppercase tracking-wide mb-3">Goals Each</label>
                                                <input type="text" id="adminNotes" 
                                                       class="w-full py-4 px-5 border-2 border-gray-200 rounded-xl focus:border-yellow-400 focus:outline-none transition-colors text-gray-900" 
                                                       placeholder="2, 1">
                                                <p class="text-sm text-gray-400 mt-2">Match the order above</p>
                                            </div>

                                            <!-- MOTM -->
                                            <div class="mb-8">
                                                <label class="block text-sm font-medium text-gray-500 uppercase tracking-wide mb-3">Man of the Match</label>
                                                <select id="adminMOTM" class="w-full py-4 px-5 border-2 border-gray-200 rounded-xl focus:border-yellow-400 focus:outline-none transition-colors text-gray-900 bg-white appearance-none cursor-pointer" style="background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 20 20%22 fill=%22%236b7280%22><path fill-rule=%22evenodd%22 d=%22M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z%22 clip-rule=%22evenodd%22/></svg>'); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1.5rem;">
                                                    <option value="">Select player...</option>
                                                    ${players.map(p => `<option value="${p.name}">${p.name}</option>`).join('')}
                                                </select>
                                            </div>
                                        </div>

                                        <!-- Hidden status field -->
                                        <input type="hidden" id="adminStatus" value="Scheduled">

                                        <!-- Buttons -->
                                        <div class="flex gap-3">
                                            <button onclick="cancelEdit()" class="flex-1 py-4 px-6 rounded-xl border-2 border-gray-200 text-gray-700 font-semibold transition-all hover:bg-gray-50">
                                                Cancel
                                            </button>
                                            <button onclick="saveMatch()" class="flex-1 py-4 px-6 rounded-xl bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-semibold transition-all">
                                                Save
                                            </button>
                                        </div>

                                        <!-- Status Message -->
                                        <div id="adminMessage" class="mt-6 text-center hidden"></div>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </main>

                    <!-- Mobile Bottom Navigation -->
                    <nav class="md:hidden fixed bottom-4 left-4 right-4 bg-white/70 backdrop-blur-xl border border-white/30 rounded-3xl flex justify-around py-3 px-2 z-50 shadow-lg shadow-black/10">
                        <button onclick="setActiveTab('overview')" class="flex flex-col items-center py-2 px-3 ${currentTab === 'overview' ? 'text-yellow-500' : 'text-gray-500'}">
                            <span class="text-xl">üìä</span>
                            <span class="text-xs mt-1 font-medium">Overview</span>
                        </button>
                        <button onclick="setActiveTab('fixtures')" class="flex flex-col items-center py-2 px-3 ${currentTab === 'fixtures' ? 'text-yellow-500' : 'text-gray-500'}">
                            <span class="text-xl">üìÖ</span>
                            <span class="text-xs mt-1 font-medium">Fixtures</span>
                        </button>
                        <button onclick="setActiveTab('results')" class="flex flex-col items-center py-2 px-3 ${currentTab === 'results' ? 'text-yellow-500' : 'text-gray-500'}">
                            <span class="text-xl">üèÜ</span>
                            <span class="text-xs mt-1 font-medium">Results</span>
                        </button>
                        <button onclick="setActiveTab('players')" class="flex flex-col items-center py-2 px-3 ${currentTab === 'players' ? 'text-yellow-500' : 'text-gray-500'}">
                            <span class="text-xl">üë•</span>
                            <span class="text-xs mt-1 font-medium">Players</span>
                        </button>
                        <button onclick="setActiveTab('admin')" class="flex flex-col items-center py-2 px-3 ${currentTab === 'admin' ? 'text-yellow-500' : 'text-gray-500'}">
                            <span class="text-xl">‚öôÔ∏è</span>
                            <span class="text-xs mt-1 font-medium">Admin</span>
                        </button>
                    </nav>
                </div>
            `;
        }

        let selectedMatchId = null;

        function selectMatch(matchId) {
            selectedMatchId = matchId;
            const form = document.getElementById('matchForm');
            const cards = document.getElementById('matchCards');
            
            const match = allMatches.find(m => m.id === matchId);
            if (!match) return;

            // Hide cards, show form
            cards.classList.add('hidden');
            form.classList.remove('hidden');

            // Set match info
            document.getElementById('matchInfo').innerHTML = `
                <div class="text-2xl font-semibold text-gray-900">${match.opponent}</div>
                <div class="text-gray-500 mt-1">${match.date} ¬∑ ${match.kickOffTime} ¬∑ ${match.venue}</div>
            `;

            // Set opponent name in score section
            const opponentNameEl = document.getElementById('opponentName');
            if (opponentNameEl) opponentNameEl.textContent = match.opponent.split(' ')[0];

            // Reset form
            document.getElementById('adminStatus').value = 'Scheduled';
            document.getElementById('adminOurScore').value = '';
            document.getElementById('adminTheirScore').value = '';
            document.getElementById('adminGoalScorers').value = '';
            document.getElementById('adminNotes').value = '';
            const motmSelect = document.getElementById('adminMOTM');
            if (motmSelect) motmSelect.value = '';

            // Reset status buttons
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('border-yellow-400', 'bg-yellow-50');
                btn.classList.add('border-gray-200');
            });

            // Hide score section
            document.getElementById('scoreSection').classList.add('hidden');
        }

        function setStatus(status) {
            document.getElementById('adminStatus').value = status;
            
            // Update button styles
            document.querySelectorAll('.status-btn').forEach(btn => {
                btn.classList.remove('border-yellow-400', 'bg-yellow-50');
                btn.classList.add('border-gray-200');
            });
            
            const activeBtn = document.getElementById('btn-' + status);
            if (activeBtn) {
                activeBtn.classList.remove('border-gray-200');
                activeBtn.classList.add('border-yellow-400', 'bg-yellow-50');
            }

            // Show/hide score section
            const scoreSection = document.getElementById('scoreSection');
            if (status === 'Played') {
                scoreSection.classList.remove('hidden');
            } else {
                scoreSection.classList.add('hidden');
            }
        }

        function cancelEdit() {
            selectedMatchId = null;
            const form = document.getElementById('matchForm');
            const cards = document.getElementById('matchCards');
            
            form.classList.add('hidden');
            cards.classList.remove('hidden');
        }

        async function saveMatch() {
            if (!selectedMatchId) {
                showAdminMessage('No match selected', 'error');
                return;
            }

            const status = document.getElementById('adminStatus').value;
            
            if (status === 'Scheduled') {
                showAdminMessage('Please select Played or Postponed', 'error');
                return;
            }

            const data = {
                id: selectedMatchId,
                status: status
            };

            if (status === 'Played') {
                data.ourScore = document.getElementById('adminOurScore').value || '0';
                data.theirScore = document.getElementById('adminTheirScore').value || '0';
                data.goalScorers = document.getElementById('adminGoalScorers').value || '';
                data.notes = document.getElementById('adminNotes').value || '';
                data.motm = document.getElementById('adminMOTM').value || '';
            } else {
                data.ourScore = '';
                data.theirScore = '';
                data.goalScorers = '';
                data.notes = '';
            }

            try {
                showAdminMessage('Saving...', 'info');
                
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                showAdminMessage('Saved! ‚úì', 'success');
                
                setTimeout(() => {
                    selectedMatchId = null;
                    fetchSheetData();
                }, 1500);

            } catch (error) {
                console.error('Error saving match:', error);
                showAdminMessage('Error: ' + error.message, 'error');
            }
        }

        function showAdminMessage(text, type) {
            const message = document.getElementById('adminMessage');
            if (!message) return;
            
            message.classList.remove('hidden', 'text-green-600', 'text-red-600', 'text-blue-600');
            
            if (type === 'success') message.classList.add('text-green-600');
            else if (type === 'error') message.classList.add('text-red-600');
            else message.classList.add('text-blue-600');
            
            message.textContent = text;
        }

        // Load data on page load
        fetchSheetData();
    </script>
</body>
</html>
