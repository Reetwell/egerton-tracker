<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Egerton U15 Lions - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="max-w-2xl mx-auto p-6">
        <!-- Header -->
        <div class="bg-gray-900 text-white rounded-lg p-6 mb-6">
            <div class="flex items-center gap-3">
                <img src="egerton-tracker.png" class="w-12 h-12" alt="Badge">
                <div>
                    <h1 class="text-xl font-bold text-yellow-400">Egerton U15 Lions</h1>
                    <p class="text-sm text-gray-400">Match Admin</p>
                </div>
            </div>
        </div>

        <!-- Match Selector -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Select Match</h2>
            <select id="matchSelect" class="w-full p-3 border border-gray-300 rounded-lg text-gray-900 bg-white" onchange="loadMatchData()">
                <option value="">-- Select a match --</option>
            </select>
        </div>

        <!-- Match Form -->
        <div id="matchForm" class="bg-white rounded-lg shadow p-6 hidden">
            <h2 class="text-lg font-semibold text-gray-900 mb-4">Update Match Details</h2>
            
            <!-- Match Info (read only) -->
            <div class="bg-gray-50 rounded-lg p-4 mb-6">
                <div id="matchInfo" class="text-gray-700"></div>
            </div>

            <!-- Status -->
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                <select id="status" class="w-full p-3 border border-gray-300 rounded-lg">
                    <option value="Scheduled">Scheduled</option>
                    <option value="Played">Played</option>
                    <option value="Postponed">Postponed</option>
                    <option value="Cancelled">Cancelled</option>
                </select>
            </div>

            <!-- Score Section (shown when status is Played) -->
            <div id="scoreSection">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Our Score</label>
                        <input type="number" id="ourScore" min="0" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="0">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Their Score</label>
                        <input type="number" id="theirScore" min="0" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="0">
                    </div>
                </div>

                <!-- Goal Scorers -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Goal Scorers</label>
                    <input type="text" id="goalScorers" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g. Finley Jones, Jack Stiles, Jack Pierce">
                    <p class="text-xs text-gray-500 mt-1">Comma separated names</p>
                </div>

                <!-- Goals per Scorer -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Goals Each (How Many Scored)</label>
                    <input type="text" id="notes" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g. 4,1,1">
                    <p class="text-xs text-gray-500 mt-1">Comma separated numbers matching the scorers above</p>
                </div>
            </div>

            <!-- Submit Button -->
            <button onclick="saveMatch()" class="w-full bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-semibold py-3 px-6 rounded-lg transition-colors">
                Save Match
            </button>

            <!-- Status Message -->
            <div id="message" class="mt-4 text-center hidden"></div>
        </div>

        <!-- Back Link -->
        <div class="text-center mt-6">
            <a href="egerton-tracker.html" class="text-blue-600 hover:text-blue-700">← Back to Tracker</a>
        </div>
    </div>

    <script>
        const SPREADSHEET_ID = '1sMHiLgwRAsnu2zWRCfdHWwuEMfefpOe30BIo_Zv01IE';
        const API_KEY = 'AIzaSyAkb76g25dIADs9Ty5CD3V7BguWe3ahLPs';
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby6a_XWdPHAjEcId0-A57dRG26w_VJlF38lsVuBqnPGzeXAo3RTM76phbB7RA5n9zuwAA/exec';

        let matches = [];

        // Load matches on page load
        async function loadMatches() {
            try {
                const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Fixtures?key=${API_KEY}`);
                const data = await response.json();
                
                if (data.values && data.values.length > 1) {
                    matches = data.values.slice(1).map(row => ({
                        id: row[0] || '',
                        date: row[1] || '',
                        kickOffTime: row[2] || '',
                        opponent: row[3] || '',
                        venue: row[4] || '',
                        competition: row[5] || '',
                        ourScore: row[6] || '',
                        goalScorers: row[7] || '',
                        notes: row[8] || '',
                        theirScore: row[9] || '',
                        status: row[10] || 'Scheduled'
                    })).filter(m => m.id);

                    const select = document.getElementById('matchSelect');
                    select.innerHTML = '<option value="">-- Select a match --</option>';
                    
                    matches.forEach(match => {
                        const option = document.createElement('option');
                        option.value = match.id;
                        option.textContent = `${match.date} - ${match.opponent} (${match.venue}) - ${match.status}`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading matches:', error);
                showMessage('Error loading matches', 'error');
            }
        }

        function loadMatchData() {
            const matchId = document.getElementById('matchSelect').value;
            const form = document.getElementById('matchForm');
            
            if (!matchId) {
                form.classList.add('hidden');
                return;
            }

            const match = matches.find(m => m.id === matchId);
            if (!match) return;

            // Show form
            form.classList.remove('hidden');

            // Set match info
            document.getElementById('matchInfo').innerHTML = `
                <div class="font-semibold">${match.opponent}</div>
                <div class="text-sm">${match.date} • ${match.kickOffTime}</div>
                <div class="text-sm">${match.venue} • ${match.competition}</div>
            `;

            // Fill form fields
            document.getElementById('status').value = match.status || 'Scheduled';
            document.getElementById('ourScore').value = match.ourScore;
            document.getElementById('theirScore').value = match.theirScore;
            document.getElementById('goalScorers').value = match.goalScorers;
            document.getElementById('notes').value = match.notes;

            // Show/hide score section based on status
            toggleScoreSection();
        }

        function toggleScoreSection() {
            const status = document.getElementById('status').value;
            const scoreSection = document.getElementById('scoreSection');
            
            if (status === 'Played') {
                scoreSection.classList.remove('hidden');
            } else {
                scoreSection.classList.add('hidden');
            }
        }

        // Add event listener for status change
        document.getElementById('status').addEventListener('change', toggleScoreSection);

        async function saveMatch() {
            const matchId = document.getElementById('matchSelect').value;
            if (!matchId) {
                showMessage('Please select a match', 'error');
                return;
            }

            const status = document.getElementById('status').value;
            const data = {
                id: matchId,
                status: status
            };

            // Only include score data if match was played
            if (status === 'Played') {
                data.ourScore = document.getElementById('ourScore').value || '0';
                data.theirScore = document.getElementById('theirScore').value || '0';
                data.goalScorers = document.getElementById('goalScorers').value || '';
                data.notes = document.getElementById('notes').value || '';
            } else {
                // Clear score data for non-played matches
                data.ourScore = '';
                data.theirScore = '';
                data.goalScorers = '';
                data.notes = '';
            }

            try {
                showMessage('Saving...', 'info');
                
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                // With no-cors we can't read the response, but if it didn't throw, it likely worked
                showMessage('Match saved successfully! ✓', 'success');
                
                // Reload matches to show updated status
                setTimeout(() => {
                    loadMatches();
                }, 1500);

            } catch (error) {
                console.error('Error saving match:', error);
                showMessage('Error saving match: ' + error.message, 'error');
            }
        }

        function showMessage(text, type) {
            const message = document.getElementById('message');
            message.classList.remove('hidden', 'text-green-600', 'text-red-600', 'text-blue-600');
            
            if (type === 'success') {
                message.classList.add('text-green-600');
            } else if (type === 'error') {
                message.classList.add('text-red-600');
            } else {
                message.classList.add('text-blue-600');
            }
            
            message.textContent = text;
        }

        // Load matches when page loads
        loadMatches();
    </script>
</body>
</html>
